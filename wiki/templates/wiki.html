<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <link rel="stylesheet" href="{% static 'wiki/entry_card.css' %}">
    <link rel="stylesheet" href="{% static 'wiki/profile_page.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'wiki/profile_page.css' %}">
    <title>Welcome</title>
    <style>
      .like-btn-custom:hover {
        color: #e25555 !important;
        background: #ffeaea;
        border-radius: 50%;
        transition: background 0.2s, color 0.2s;
      }
      .comment-btn-custom:hover {
        color: #0d6efd !important;
        background: #eaf1ff;
        border-radius: 50%;
        transition: background 0.2s, color 0.2s;
      }
      .top-nav-btns .btn {
        margin-left: 0.5em;
      }
      .post-content img {
        max-width: 100%;
        width: auto;
        height: auto;
        border-radius: 8px;
        margin: 1em 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: block;
      }
      .post-content em {
        font-style: italic;
      }
      .post-card {
        overflow: hidden;
      }
      .card-body {
        overflow-wrap: break-word;
        word-wrap: break-word;
      }
    </style>
</head>
<body>
  <div class="default_buttons d-flex justify-content-between align-items-center px-4">
    <h2 class="bar-title">Welcome to SocialDistribution, {{ request.user.username }}!</h2>
    <a href="{% url 'wiki:profile' request.user.username %}" class="btn btn-primary">Go to Profile</a>
    <a href="/s25-project-white/authors/" class="btn btn-primary">Browse Authors</a>
    <a href="{% url 'wiki:create_entry' %}" class="btn btn-primary">Create New Entry</a>
  </div>
  <div style="height:5.5em"></div>
  <div class="container mt-4">
    {% if entries %}
      {% for entry, rendered in entries %}
      <div class="card mb-4 shadow-sm post-card">
        <div class="card-body">
          <a href="{% url 'wiki:entry_detail' entry.serial %}" style="text-decoration:none;color:inherit;">
            <div class="d-flex align-items-center mb-2 post-header">
              {% if entry.author.profileImage %}
                <img class="profile_image" src="{{ entry.author.profileImage }}" alt="Profile image">
              {% else %}
                <img class="profile_image" src="https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909_640.png" alt="Default image">
              {% endif %}
              <div>
                <div class="post-title">{{ entry.title }}</div>
                <small class="text-muted">
                  Posted by <strong>{{ entry.author.displayName }}</strong>
                  on {{ entry.created_at|date:"M d, Y H:i" }}
                </small>
              </div>
            </div>
            {% if entry.image %}
              <div style="margin: 1em 0;">
                <img class='entry_image' src="{{ entry.image.url }}" alt="Post image"/>
              </div>
            {% endif %}

            {% if entry.contentType == "image/jpeg;base64" or entry.contentType == "image/png;base64" %}
                <div class="post-content text-center">
                    <img src="data:{{ entry.contentType }},{{ entry.content }}" alt="Base64 Image" class="img-fluid" />
                </div>
            {% elif entry.contentType == "text/markdown" %}
                <div class="post-content markdown-content">
                    {{ rendered|safe }}
                </div>
            {% else %}
                <div class="post-content">
                    {{ entry.content }}
                </div>
            {% endif %}

          </a>
          <div class="d-flex align-items-center gap-3 post-footer mt-2">
            <form method="post" action="{% url 'wiki:like-entry' entry.serial %}" class="m-0 p-0">
              {% csrf_token %}
              <button type="submit" class="like-btn like-btn-custom border-0 bg-transparent" style="font-size: 1.5rem;">
                ‚ù§Ô∏è
              </button>
              <span class="ms-1">{{ entry.likes.count }}</span>
            </form>
            <a href="{% url 'wiki:entry_detail' entry.serial %}#comments" class="btn btn-outline-secondary btn-sm comment-btn-custom">
              üí¨ Comment ({{ entry.comments.count }})
            </a>
            <button type="button" class="btn btn-outline-success btn-sm share-link-btn" data-link="{{ request.scheme }}://{{ request.get_host }}{% url 'wiki:entry_detail' entry.serial %}">üîó Share Link</button>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>No entries yet. Click "Create New Entry" to get started!</p>
    {% endif %}
  </div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.share-link-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        const link = btn.getAttribute('data-link');
        navigator.clipboard.writeText(link).then(function() {
          btn.textContent = '‚úÖ Copied!';
          setTimeout(() => { btn.textContent = 'üîó Share Link'; }, 1200);
        }, function() {
          alert('Failed to copy link');
        });
      });
    });
  });
</script>
</html>
