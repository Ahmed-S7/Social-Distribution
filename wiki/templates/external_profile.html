{% load static %}

<body>
  <div class="default_buttons d-flex justify-content-between align-items-center px-4" style="background:#89c6e1; width: 100%; position: fixed; top: 0; left: 0; z-index: 100; height: 4.5em; padding: 1em 2em;">
    <link rel="stylesheet" href="{% static 'wiki/profile_page.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <a href="{% url 'wiki:profile' request.user.username %}" class="btn btn-primary">Back to Profile</a>
    <div>
      <a href="{% url 'wiki:view_authors' %}" class="btn btn-primary">Back To Authors List</a>
      <a href="{% url 'wiki:user-wiki' request.user.username %}" class="btn btn-primary">Back to Stream</a>
    </div>
  </div>
  <div style="height:5.5em"></div>
  <div class="container mt-4">

  <section class="author_profile_with_entries">

    <section class="author_profile_description_follow_button">

      <section class="author_profile_follow_button">

        <section class="pic_name_followers_entries">

          <section class="profile_pic_and_name">

            <!--Authenticated user check successful, then make the profile picture clickable -->
            {% if request.user.is_authenticated %}

              <!--Make profile picture lead to pfp editing-->
              {% if author.profileImage %}
                <img class="profile_image_logged_user" src="{{ author.profileImage.url }}" alt="Profile Picture">
              {% else %}
                <img class="profile_image_logged_user" src="https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909_640.png" alt="Default image">
              {% endif %}
              <!--end of profile image check-->

              <!--Authenticated user check fails, then make the profile picture non-clickable -->
            {% else %}

              {% if author.image %}

                <img class="profile_image" src="{{ author.imageProfile.url }}" alt="Profile Picture">
              {% else %}
                <img class="profile_image" src="https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909_640.png" alt="Default image">
              {% endif %}

            {% endif %}

            <h3 class="display_name">{{ author.displayName }}</h3>

          </section>

          <!--Titles For Follow And Entry Details-->
          <section class="follow_and_entry_labels">
            <p class="folow_and_entry_count"> {{entry_count}} </p>
            <p class="follow_and_entry_title"> Entries</p>
          </section>    

          <section class="follow_and_entry_labels">
            <p class="folow_and_entry_count"> {{friend_count}} </p>
            <p class="follow_and_entry_title"> Friends</p>
          </section>    

          <section class="follow_and_entry_labels">
            <p class="folow_and_entry_count"> {{follower_count}} </p>
            <p class="follow_and_entry_title"> Followers</p>
          </section>     

          <section class="follow_and_entry_labels">
            <p class="folow_and_entry_count"> {{following_count}} </p>
            <p class="follow_and_entry_title"> Following</p>
          </section> 

        </section> 


        <section class="follow_info_button">    

          {% if is_a_friend %}
          <form action="{% url 'wiki:unfollow_profile' author.serial follow_id %}" method="POST">

            {% csrf_token %}
            <button class="unfriend_button" name='action' value='unfriend' type="submit" >Unfriend User </button> 

          </form>
          {% elif is_following %}

          <form action="{% url 'wiki:unfollow_profile' author.serial follow_id %}" method="POST">
            {% csrf_token %}
            <button class="unfollow_button" name='action' value='unfollow' type="submit" >UnFollow Profile</button>

          </form>

          {% elif is_currently_requesting %}

          <form action="{% url 'wiki:cancel_follow_request' author.serial request_id %}" method="POST">
            {% csrf_token %}
            <button class="unrequest_button" type="submit" >Cancel Request</button>

          </form>

          {% else %}

          <form action="{% url 'wiki:follow_profile' author.serial %}" method="POST">
            {% csrf_token %}
            <button class="follow_button" type="submit">Follow Profile</button> 
          </form>

          {% endif%}
        </section>


      </section>


      <section class="description_content">

        {% if author.description  %}
          <p>{{ author.description }} </p>
        {% else  %}
          <p>No Description</p>
        {% endif %}

        {% if author.github %}
          <p>{{ author.github}} </p>
        {% else  %}
          <p>GitHub Profile Not Found</p>
        {% endif %}

      </section> 



    </section>

    <section class="entry_list">
      <h3 class="title">Entries</h3>
      {% if entries %}

        {% for entry in entries %}
        
          <link rel="stylesheet" href="{% static 'wiki/entry_card.css' %}">
          
          <div class="post-card">
            <!--Now clicking an entry (entry header) should lead to entry details-->
            <a href="{% url 'wiki:entry_detail' entry.serial %}">
              <div class="post-header">

                <div>
                  <div class="post-title">{{ entry.title }}</div>
                  <small>
                    Posted by <strong>{{ entry.author.displayName }}</strong>
                    on {{ entry.created_at|date:"M d, Y H:i" }}
                  </small>
                </div>
              </div>
            

              {% if entry.image %}
                <div style="margin: 1em 0;">
                  <img class='entry_image' src="{{ entry.image.url }}" alt="Post image"/>

                </div>
              {% endif %} 
              <div class="post-content">{{ entry.content }}</div>
            </a>
              <div class="post-footer">
                <form method="post" action="{% url 'wiki:like-entry' entry.serial %}">
                  {% csrf_token %}
                  <input type="hidden" name="liked_from_profile" value="true">
                  <button type="submit" class="like-btn">‚ù§Ô∏è{{ entry.likes.count}} </button>
                </form>
                <!--<p>{{ entry.likes.count }} likes</p>-->

                <a href="{% url 'wiki:entry_detail' entry.serial %}" class="comment-btn">üí¨ Comment ({{ entry.comments.count }})</a>
              </div>
            </div>
        {% endfor %}
      {% endif %}
    </section>

  </section>

  </div>
</body>

        